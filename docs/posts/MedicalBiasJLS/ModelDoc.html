<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Sophie Seiple, Julia Joy, Lindsey Schweitzer">
<meta name="dcterms.date" content="2024-01-01">
<meta name="description" content="Process of model creation.">

<title>My Awesome CSCI 0451 Blog - Final Project Results, Model Creation Document</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>

      .quarto-title-block .quarto-title-banner h1,
      .quarto-title-block .quarto-title-banner h2,
      .quarto-title-block .quarto-title-banner h3,
      .quarto-title-block .quarto-title-banner h4,
      .quarto-title-block .quarto-title-banner h5,
      .quarto-title-block .quarto-title-banner h6
      {
        color: white;
      }

      .quarto-title-block .quarto-title-banner {
        color: white;
background-image: url(../../img/landscape.png);
background-size: cover;
      }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">My Awesome CSCI 0451 Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About Me!</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Final Project Results, Model Creation Document</h1>
                  <div>
        <div class="description">
          Process of model creation.
        </div>
      </div>
                </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Sophie Seiple, Julia Joy, Lindsey Schweitzer </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">January 1, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<div id="cell-1" class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> itertools <span class="im">import</span> combinations</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeClassifier</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> GridSearchCV, cross_val_score, train_test_split</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.svm <span class="im">import</span> SVC</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> LabelEncoder</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="reading-in-our-data" class="level3">
<h3 class="anchored" data-anchor-id="reading-in-our-data">Reading in our Data</h3>
<div id="cell-3" class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>conditions_diabetes <span class="op">=</span> pd.read_csv(<span class="st">'conditions_diabetes.csv'</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>conditions_pregnancy <span class="op">=</span> pd.read_csv(<span class="st">'conditions_pregnancy.csv'</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>conditions_cancer <span class="op">=</span> pd.read_csv(<span class="st">'conditions_cancer.csv'</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>conditions_heart <span class="op">=</span> pd.read_csv(<span class="st">'conditions_heart.csv'</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>conditions_lungs <span class="op">=</span> pd.read_csv(<span class="st">'conditions_lungs.csv'</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>observations <span class="op">=</span> pd.read_csv(<span class="st">'observations_pivot.csv'</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>patients <span class="op">=</span> pd.read_csv(<span class="st">'patient_clean.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note: All of our datasets are grouped by related diseases (for example diabetes and comorbitidies such as diabetic retinopathy), for the rest of the post, when we say “diabetes” or “pregnancy complications,” we are talking about diabetes and all present comorbidites, or a grouping of pregnancy complications such as pre/ante eclampsia and misscarriage.</p>
</section>
<section id="diabetes-modeling-analysis" class="level1">
<h1>Diabetes Modeling &amp; Analysis</h1>
<section id="prepping-data" class="level3">
<h3 class="anchored" data-anchor-id="prepping-data">1. Prepping Data</h3>
<p>In order to prep our data for modelling we label encoded each of the qualitative variables (keeping track so we could decode them again later). We created a function in order to do this easily multiple times.</p>
<div id="cell-8" class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>le <span class="op">=</span> LabelEncoder()</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># our data-prepping function for modeling</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> prep_data(df):</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># label encode all quantitative vars</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"race"</span>] <span class="op">=</span> le.fit_transform(df[<span class="st">"race"</span>]) </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    race_code <span class="op">=</span> {code: race <span class="cf">for</span> code, race <span class="kw">in</span> <span class="bu">enumerate</span>(le.classes_)}</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"ethnicity"</span>] <span class="op">=</span> le.fit_transform(df[<span class="st">"ethnicity"</span>])</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    eth_code <span class="op">=</span> {code: ethnicity <span class="cf">for</span> code, ethnicity <span class="kw">in</span> <span class="bu">enumerate</span>(le.classes_)}</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"gender"</span>] <span class="op">=</span> le.fit_transform(df[<span class="st">"gender"</span>])</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    gen_code <span class="op">=</span> {code: gender <span class="cf">for</span> code, gender <span class="kw">in</span> <span class="bu">enumerate</span>(le.classes_)}</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"birthplace"</span>] <span class="op">=</span> le.fit_transform(df[<span class="st">"birthplace"</span>])</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    bp_code <span class="op">=</span> {code: bp <span class="cf">for</span> code, bp <span class="kw">in</span> <span class="bu">enumerate</span>(le.classes_)}</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"curr_town"</span>] <span class="op">=</span> le.fit_transform(df[<span class="st">"curr_town"</span>]) </span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    curr_code <span class="op">=</span> {code: bp <span class="cf">for</span> code, bp <span class="kw">in</span> <span class="bu">enumerate</span>(le.classes_)}</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># split data into test and train</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    train, test <span class="op">=</span> train_test_split(df, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    X_train <span class="op">=</span> train.drop(columns<span class="op">=</span>[<span class="st">'y'</span>])</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    y_train <span class="op">=</span> train[<span class="st">'y'</span>]</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    X_test <span class="op">=</span> test.drop(columns<span class="op">=</span>[<span class="st">'y'</span>])</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    y_test <span class="op">=</span> test[<span class="st">'y'</span>]</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># return split x, y, and all of the code tracking dicts</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> X_train, y_train, X_test, y_test, race_code, eth_code, gen_code, bp_code, curr_code</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-9" class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">300</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>X_train, y_train, X_test, y_test, race_code, eth_code, gen_code, bp_code, curr_code <span class="op">=</span> prep_data(conditions_diabetes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="finding-optimal-model" class="level3">
<h3 class="anchored" data-anchor-id="finding-optimal-model">2. Finding optimal model</h3>
<p>Next, we created a function we could reuse that identifies the best performing model on our data from the options random forest, SVC, logistic regression, and decision trees. The best model is what we use to predict the probability that each person has a certain disease (for our purposes, their risk score).</p>
<div id="cell-12" class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># our model-finding function</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train_model(X_train, y_train):</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">#LogisticRegression</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    LR <span class="op">=</span> LogisticRegression(max_iter<span class="op">=</span><span class="dv">10000000000000000000</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    LRScore <span class="op">=</span> cross_val_score(LR, X_train, y_train, cv<span class="op">=</span><span class="dv">5</span>).mean()</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">#DecisionTreeClassifier</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    param_grid <span class="op">=</span> { <span class="st">'max_depth'</span>: [ <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="va">None</span> ]}</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    tree <span class="op">=</span> DecisionTreeClassifier()</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    grid_search <span class="op">=</span> GridSearchCV(tree, param_grid, cv<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    grid_search.fit(X_train, y_train)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    DTCScore  <span class="op">=</span> grid_search.best_score_</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    bestDTCDepth <span class="op">=</span> grid_search.best_params_</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Random Forrest Classifier    </span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    forrest <span class="op">=</span> RandomForestClassifier(random_state<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    grid_search <span class="op">=</span> GridSearchCV(forrest, param_grid, cv<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    grid_search.fit(X_train, y_train)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    RFCScore  <span class="op">=</span> grid_search.best_score_</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    bestRFCDepth <span class="op">=</span> grid_search.best_params_</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">#SVC</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>    SVM <span class="op">=</span> SVC()</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># use grid search to find best gamma for SVM</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    g <span class="op">=</span> {<span class="st">'gamma'</span>: <span class="fl">10.0</span> <span class="op">**</span> np.arange(<span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>) }</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    grid_search <span class="op">=</span> GridSearchCV(SVM, g, cv<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>    grid_search.fit(X_train, y_train)</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>    SVMScore  <span class="op">=</span> grid_search.best_score_   </span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"best LR :"</span>, LRScore)</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"best DTC:"</span>, DTCScore)</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"best max depth: "</span>, bestDTCDepth)</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"best RFC: "</span>, RFCScore)</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"best max depth: "</span>, bestRFCDepth)</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"best SVM: "</span>, SVMScore)</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># store the scores of each model</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>    max_score <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>    max_model <span class="op">=</span> <span class="st">""</span></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> LRScore <span class="op">&gt;</span> max_score:</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>        max_score <span class="op">=</span> LRScore</span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>        max_model <span class="op">=</span> <span class="st">"LR"</span></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> DTCScore <span class="op">&gt;</span> max_score:</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>        max_score <span class="op">=</span> DTCScore</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>        max_model <span class="op">=</span> <span class="st">"DTC"</span></span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> RFCScore <span class="op">&gt;</span> max_score:</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>        max_score <span class="op">=</span> RFCScore</span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>        max_model <span class="op">=</span> <span class="st">"RFC"</span></span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> SVMScore <span class="op">&gt;</span> max_score:</span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>        max_score <span class="op">=</span> SVMScore</span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>        max_model <span class="op">=</span> <span class="st">"SVM"</span></span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"best score overall is: "</span>, max_score, <span class="st">" with model: "</span>, max_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-13" class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># run model finding function on our diabetes data</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">500</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>train_model(X_train, y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>best LR : 0.9050401672719269
best DTC: 0.9178790213124979
best max depth:  {'max_depth': 3}
best RFC:  0.9153112505043837
best max depth:  {'max_depth': 5}
best SVM:  0.9016066908770772
best score overall is:  0.9178790213124979  with model:  DTC</code></pre>
</div>
</div>
<p>The results of our function should that the decision tree classifier is the best model possible, with an accuracy of 91.78%. Our accuracies tend generally lower considering the limited information we allowed the model to have, as we really wanted to see what the model would do when it predicted on identity factors such as race, ethnicity, and birthplace, and not how it would predict given information on the specific procedures and allergies a patient had.</p>
</section>
<section id="create-risk-scores" class="level3">
<h3 class="anchored" data-anchor-id="create-risk-scores">3. Create Risk Scores</h3>
<p>Predict probabilities for all our entries using the best model we found.</p>
<div id="cell-17" class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>dtc <span class="op">=</span> DecisionTreeClassifier(max_depth<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>dtc.fit(X_train, y_train)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>pred_prob <span class="op">=</span> dtc.predict_proba(X_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For ease we created a risk finding function that can be used across factors and disease probabilities.</p>
<div id="cell-19" class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_risk(code, col, probs):</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># finds the corresponding subset of our probability data</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    indices <span class="op">=</span> (X_test[col] <span class="op">==</span> code)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    prob_subset <span class="op">=</span> probs[indices]</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># finds the average of this subset</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    av_prob <span class="op">=</span> np.mean(prob_subset[:, <span class="dv">1</span>]) </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> av_prob   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="compare-across-race-gender-ethnicity" class="level3">
<h3 class="anchored" data-anchor-id="compare-across-race-gender-ethnicity">4. Compare Across Race, Gender, Ethnicity</h3>
<p>Next, we find the average risk score for different demographic characteristics: Race, Gender, and Ethnicity.</p>
<section id="race" class="level4">
<h4 class="anchored" data-anchor-id="race">Race</h4>
<div id="cell-22" class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>diabetesRaceRisk <span class="op">=</span> []</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># find risk for each race (after finding on their code from the label encoder)</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> code, race <span class="kw">in</span> race_code.items():</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    avRisk <span class="op">=</span> find_risk(code, <span class="st">'race'</span>, pred_prob)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    newRow <span class="op">=</span> {<span class="st">'race'</span>: race, <span class="st">'risk'</span>: avRisk}</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    diabetesRaceRisk.append(newRow)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co"># print summary table</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>diabetesRaceRisk <span class="op">=</span> pd.DataFrame(diabetesRaceRisk)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>diabetesRaceRisk <span class="op">=</span> diabetesRaceRisk.sort_values(by<span class="op">=</span><span class="st">'risk'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>diabetesRaceRisk</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="72">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">race</th>
<th data-quarto-table-cell-role="th">risk</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>asian</td>
<td>0.479592</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>hispanic</td>
<td>0.340659</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>white</td>
<td>0.312536</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>black</td>
<td>0.256158</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Our model tells us that the most susceptible group to diabetes is Asian, then Hispanic and White, with Black being the least susceptible. These results were interesting in that they do indeed indicate that there may be a difference according to race, and made us think of how we could explore demographic information about Massachussetts (where our data is “from”), to understand whether these trends are reflective of larger trends.</p>
</section>
<section id="gender" class="level4">
<h4 class="anchored" data-anchor-id="gender">Gender</h4>
<div id="cell-25" class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>diabetesGenderRisk <span class="op">=</span> []</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> code, gender <span class="kw">in</span> gen_code.items():</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    avRisk <span class="op">=</span> find_risk(code, <span class="st">'gender'</span>, pred_prob)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    newRow <span class="op">=</span> {<span class="st">'gender'</span>: gender, <span class="st">'risk'</span>: avRisk}</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    diabetesGenderRisk.append(newRow)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>diabetesGenderRisk <span class="op">=</span> pd.DataFrame(diabetesGenderRisk)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>diabetesGenderRisk <span class="op">=</span> diabetesGenderRisk.sort_values(by<span class="op">=</span><span class="st">'risk'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>diabetesGenderRisk</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="73">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">gender</th>
<th data-quarto-table-cell-role="th">risk</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>F</td>
<td>0.375356</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>M</td>
<td>0.263908</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Our model tells us that women are slightly more likely to experience diabetes (or comorbidities) than men, which is in line with medical research we’ve seen.</p>
</section>
<section id="ethnicity" class="level4">
<h4 class="anchored" data-anchor-id="ethnicity">Ethnicity</h4>
<div id="cell-28" class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>av_risk_eth <span class="op">=</span> []</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> code, name <span class="kw">in</span> eth_code.items():</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    av <span class="op">=</span> find_risk(code, <span class="st">'ethnicity'</span>, pred_prob)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    new_row <span class="op">=</span> {<span class="st">'eth'</span>: name, <span class="st">'risk'</span>: av}</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    av_risk_eth.append(new_row)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>av_risk_eth_df <span class="op">=</span> pd.DataFrame(av_risk_eth)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>av_risk_eth_df <span class="op">=</span> av_risk_eth_df.sort_values(by<span class="op">=</span><span class="st">'risk'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>av_risk_eth_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="74">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">eth</th>
<th data-quarto-table-cell-role="th">risk</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>asian_indian</td>
<td>0.714286</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>polish</td>
<td>0.558405</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>german</td>
<td>0.492674</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">12</td>
<td>mexican</td>
<td>0.428571</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>american</td>
<td>0.428571</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">14</td>
<td>portuguese</td>
<td>0.397959</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>english</td>
<td>0.369491</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>scottish</td>
<td>0.333333</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">15</td>
<td>puerto_rican</td>
<td>0.329670</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>dominican</td>
<td>0.328571</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>african</td>
<td>0.318681</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>italian</td>
<td>0.314127</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>central_american</td>
<td>0.306122</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>french</td>
<td>0.285714</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>french_canadian</td>
<td>0.261905</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>chinese</td>
<td>0.244898</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>swedish</td>
<td>0.205128</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">16</td>
<td>russian</td>
<td>0.200000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>irish</td>
<td>0.182902</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>west_indian</td>
<td>0.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>This table gives us lots of information about risk by ethnicity, most interestingly perhaps, it agrees with our race finding that Asian people are more likely to experience diabetes, in that our most at risk ethnicity was Asian Indian. However, Chinese and West Indian, the two other Asian ethnicities in the datasest are at the bottom of the risk hierarchy, which made us consider that the risk of Asian Indian people specifically, and alone, was what was driving our race findings.</p>
</section>
</section>
<section id="compare-across-wealthier-poorer-towns-of-residencebirthplace" class="level3">
<h3 class="anchored" data-anchor-id="compare-across-wealthier-poorer-towns-of-residencebirthplace">5. Compare Across Wealthier &amp; Poorer Towns of Residence/Birthplace</h3>
<p>In order to compare outcomes across towns of varying socioeconomic status, we compiled a list of the richest and poorest towns present in our dataset (using Census data).</p>
<div id="cell-32" class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># richest towns in Mass</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>richTowns <span class="op">=</span> [<span class="st">"Dover"</span>, <span class="st">"Weston"</span>, <span class="st">"Wellesley"</span>, <span class="st">"Lexington"</span>, <span class="st">"Sherborn"</span>, <span class="st">"Cohasset"</span>, <span class="st">"Lincoln"</span>, <span class="st">"Carlisle"</span>, <span class="st">"Hingham"</span>, <span class="st">"Winchester"</span>, </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Medfield"</span>, <span class="st">"Concord"</span>, <span class="st">"Needham"</span>, <span class="st">"Sudbury"</span>, <span class="st">"Hopkinton"</span>, <span class="st">"Boxford"</span>, <span class="st">"Brookline"</span>, <span class="st">"Andover"</span>,  </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Southborough"</span>, <span class="st">"Belmont"</span>, <span class="st">"Acton"</span>, <span class="st">"Marblehead"</span>, <span class="st">"Newton"</span>, <span class="st">"Nantucket"</span>, <span class="st">"Duxbury"</span>, <span class="st">"Boxborough"</span>, <span class="st">"Westwood"</span>,<span class="st">"Natick"</span>, </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Longmeadow"</span>, <span class="st">"Marion"</span>, <span class="st">"Groton"</span>, <span class="st">"Newbury"</span>, <span class="st">"North Andover"</span>, <span class="st">"Sharon"</span>, <span class="st">"Arlington"</span>, <span class="st">"Norwell"</span>, <span class="st">"Reading"</span>, </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Lynnfield"</span>, <span class="st">"Marshfield"</span>, <span class="st">"Holliston"</span>, <span class="st">"Medway"</span>, <span class="st">"Canton"</span>, <span class="st">"Milton"</span>, <span class="st">"Ipswich"</span>, <span class="st">"Littleton"</span>, <span class="st">"Westford"</span>, <span class="st">"North Reading"</span>, <span class="st">"Chelmsford"</span>, <span class="st">"Dedham"</span>,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Walpole"</span>, <span class="st">"Mansfield"</span>, <span class="st">"Shrewsbury"</span>, <span class="st">"Norwood"</span>, <span class="st">"Hanover"</span>, <span class="st">"Stow"</span>, <span class="st">"Newburyport"</span>, <span class="st">"Chatham"</span>, <span class="st">"Orleans"</span>, <span class="st">"Harwich"</span>,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Swampscott"</span>,<span class="st">"Fairhaven"</span>, <span class="st">"Salem"</span>]</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co"># poorest towns in Mass</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>poorTowns <span class="op">=</span> [<span class="st">"Springfield"</span>, <span class="st">"Lawrence"</span>, <span class="st">"Holyoke"</span>, <span class="st">"Amherst"</span>, <span class="st">"New Bedford"</span>, <span class="st">"Chelsea"</span>, <span class="st">"Fall River"</span>, <span class="st">"Athol"</span>, <span class="st">"Orange"</span>, <span class="st">"Lynn"</span>, <span class="st">"Fitchburg"</span>, <span class="st">"Gardner"</span>, <span class="st">"Brockton"</span>, <span class="st">"Malden"</span>, <span class="st">"Worcester"</span>, <span class="st">"Chicopee"</span>, <span class="st">"North Adams"</span>, <span class="st">"Everett"</span>,</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Ware"</span>, <span class="st">"Dudley"</span>, <span class="st">"Greenfield Town"</span>, <span class="st">"Weymouth Town"</span>, <span class="st">"Montague"</span>, <span class="st">"Revere"</span>, <span class="st">"Taunton"</span>, <span class="st">"Adams"</span>, <span class="st">"Huntington"</span>, <span class="st">"Charlemont"</span>, <span class="st">"Leominster"</span>, <span class="st">"Florida"</span>, <span class="st">"Colrain"</span>, <span class="st">"Hardwick"</span>,</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Palmer Town"</span>, <span class="st">"Peabody"</span>, <span class="st">"Somerville"</span>, <span class="st">"Lowell"</span>, <span class="st">"Westfield"</span>, <span class="st">"Billerica"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create a df with all the information for the rich and poor towns</p>
<div id="cell-34" class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_town_info_row(town, bp_code_swapped, townCounts_df, code_name):</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    code <span class="op">=</span> bp_code_swapped[town]</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> townCounts_df[townCounts_df[code_name] <span class="op">==</span> code].empty:</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>        count <span class="op">=</span> townCounts_df[townCounts_df[code_name] <span class="op">==</span> code][<span class="st">'count'</span>].values[<span class="dv">0</span>]</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>        count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    new_row <span class="op">=</span> {code_name: town, <span class="st">'code'</span>: code, <span class="st">'count'</span>: count}</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    new_row_df <span class="op">=</span> pd.DataFrame([new_row])</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> new_row_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-35" class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_town_info_all(counts, code_name):</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    townCounts_df <span class="op">=</span> pd.merge(X_test, counts, on<span class="op">=</span>code_name)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    town_info_rich <span class="op">=</span> pd.DataFrame(columns<span class="op">=</span>[code_name, <span class="st">'code'</span>, <span class="st">'count'</span>])</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    town_info_poor <span class="op">=</span> pd.DataFrame(columns<span class="op">=</span>[code_name, <span class="st">'code'</span>, <span class="st">'count'</span>])</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    bp_code_swapped <span class="op">=</span> {value: key <span class="cf">for</span> key, value <span class="kw">in</span> bp_code.items()}</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> town <span class="kw">in</span> richTowns:</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>        new_row_df <span class="op">=</span> find_town_info_row(town, bp_code_swapped, townCounts_df, code_name)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>        town_info_rich <span class="op">=</span> pd.concat([town_info_rich, new_row_df], ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> town <span class="kw">in</span> poorTowns:</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>        new_row_df <span class="op">=</span> find_town_info_row(town, bp_code_swapped, townCounts_df, code_name)</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>        town_info_poor<span class="op">=</span> pd.concat([town_info_poor, new_row_df], ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> town_info_rich, town_info_poor</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>birthplace_counts <span class="op">=</span> X_test.groupby(<span class="st">'birthplace'</span>).size().reset_index(name<span class="op">=</span><span class="st">'count'</span>)</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>town_info_rich, town_info_poor <span class="op">=</span> find_town_info_all(birthplace_counts, <span class="st">'birthplace'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We proceed with the following code to get the list of towns that sum up to 65 people from the richest towns, and 65 people from the poorest towns.</p>
<div id="cell-37" class="cell" data-execution_count="78">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_towns_by_sum_pop(town_info, code_name):</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    townsUsed <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    peopleCount <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> index, row <span class="kw">in</span> town_info.iterrows():</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> peopleCount <span class="op">&gt;</span> <span class="dv">65</span>:</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>        name <span class="op">=</span> row[code_name]</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>        count <span class="op">=</span> row[<span class="st">'count'</span>]</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>        townsUsed.add(name)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>        peopleCount <span class="op">+=</span> count</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> townsUsed, peopleCount</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>richTownsUsed, richPeopleCount <span class="op">=</span> get_towns_by_sum_pop(town_info_rich, <span class="st">'birthplace'</span>)</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>poorTownsUsed, poorPeopleCount <span class="op">=</span> get_towns_by_sum_pop(town_info_poor, <span class="st">'birthplace'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="birthplace" class="level3">
<h3 class="anchored" data-anchor-id="birthplace">Birthplace</h3>
<div id="cell-39" class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_av_prob_bp(townsUsed, code_name, bp_code):</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    town_codes <span class="op">=</span> []</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    bp_code_swapped <span class="op">=</span> {value: key <span class="cf">for</span> key, value <span class="kw">in</span> bp_code.items()}</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> town_full <span class="kw">in</span> townsUsed:</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>        town_codes.append(bp_code_swapped[town_full])</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    indices <span class="op">=</span> X_test[code_name].isin(town_codes)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    prob_subset <span class="op">=</span> pred_prob[indices]</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    av_prob <span class="op">=</span> np.mean(prob_subset[:, <span class="dv">1</span>]) </span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> av_prob</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-40" class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>av_rich_prob <span class="op">=</span> get_av_prob_bp(richTownsUsed, <span class="st">'birthplace'</span>, bp_code)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>av_poor_prob <span class="op">=</span> get_av_prob_bp(poorTownsUsed, <span class="st">'birthplace'</span>, bp_code)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"av_rich_prob: "</span>, av_rich_prob, <span class="st">"av_poor_prob: "</span>, av_poor_prob)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>av_rich_prob:  0.33305156382079454 av_poor_prob:  0.31947027331642713</code></pre>
</div>
</div>
<p>We find that there is not much difference in the average risk of diabetes when comparing poor and rich birthplace towns.</p>
</section>
<section id="current-town-of-residence" class="level3">
<h3 class="anchored" data-anchor-id="current-town-of-residence">Current Town of Residence</h3>
<p>Create a dataframe with the information for rich and poor towns. Then get the list of towns that sum up to 65 people from the richest towns, and 65 people from the poorest towns.</p>
<div id="cell-44" class="cell" data-execution_count="81">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>curr_counts <span class="op">=</span> X_test.groupby(<span class="st">'curr_town'</span>).size().reset_index(name<span class="op">=</span><span class="st">'count'</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>town_info_rich, town_info_poor <span class="op">=</span> find_town_info_all(curr_counts, <span class="st">'curr_town'</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>richTownsUsed, richPeopleCount <span class="op">=</span> get_towns_by_sum_pop(town_info_rich, <span class="st">'curr_town'</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>poorTownsUsed, poorPeopleCount <span class="op">=</span> get_towns_by_sum_pop(town_info_poor, <span class="st">'curr_town'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-45" class="cell" data-execution_count="82">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>av_rich_prob <span class="op">=</span> get_av_prob_bp(richTownsUsed, <span class="st">'curr_town'</span>, bp_code)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>av_poor_prob <span class="op">=</span> get_av_prob_bp(poorTownsUsed, <span class="st">'curr_town'</span>, bp_code)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co">#HERE</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"av_rich_prob: "</span>, av_rich_prob, <span class="st">"av_poor_prob: "</span>, av_poor_prob)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>av_rich_prob:  0.25274725274725274 av_poor_prob:  0.2827087442472057</code></pre>
</div>
</div>
<p>In this comparison, we find that people currently residing in rich towns have slightly lower rates of diabetes than those residing in poorer towns.</p>
</section>
</section>
<section id="pregnancy-analysis" class="level1">
<h1>Pregnancy Analysis</h1>
<p>We repeated the same exact process as above for each of our condition subsets.</p>
<p>Finding the best model:</p>
<div id="cell-50" class="cell" data-execution_count="83">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">567</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>X_train, y_train, X_test, y_test, race_code, eth_code, gen_code, bp_code, curr_code <span class="op">=</span> prep_data(conditions_pregnancy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-51" class="cell" data-execution_count="84">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">567</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>train_model(X_train, y_train) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>best LR : 0.9538094714060378
best DTC: 0.9632185172957705
best max depth:  {'max_depth': 1}
best RFC:  0.9632185172957705
best max depth:  {'max_depth': 1}
best SVM:  0.9632185172957705
best score overall is:  0.9632185172957705  with model:  DTC</code></pre>
</div>
</div>
<section id="compute-average-risk-scores" class="level3">
<h3 class="anchored" data-anchor-id="compute-average-risk-scores">Compute Average Risk scores</h3>
<p>Predict probabilities for all our entries using the best model we found</p>
<div id="cell-54" class="cell" data-execution_count="85">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>DTC <span class="op">=</span> DecisionTreeClassifier(max_depth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>DTC.fit(X_train, y_train)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>pred_prob <span class="op">=</span> DTC.predict_proba(X_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="race-1" class="level3">
<h3 class="anchored" data-anchor-id="race-1">Race</h3>
<div id="cell-56" class="cell" data-execution_count="86">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>pregRaceRisk <span class="op">=</span> []</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> code, race <span class="kw">in</span> race_code.items():</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    avRisk <span class="op">=</span> find_risk(code, <span class="st">'race'</span>, pred_prob)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    newRow <span class="op">=</span> {<span class="st">'race'</span>: race, <span class="st">'risk'</span>: avRisk}</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    pregRaceRisk.append(newRow)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>pregRaceRisk <span class="op">=</span> pd.DataFrame(pregRaceRisk)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>pregRaceRisk <span class="op">=</span> pregRaceRisk.sort_values(by<span class="op">=</span><span class="st">'risk'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>pregRaceRisk</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="86">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">race</th>
<th data-quarto-table-cell-role="th">risk</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>black</td>
<td>0.051395</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>hispanic</td>
<td>0.038217</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>asian</td>
<td>0.037262</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>white</td>
<td>0.034260</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Here we can see that being black gives a patient a little less than double the risk of pregnancy issues than being white. Hispanics have the second highest rate of pregnancy complications.</p>
</section>
<section id="gender-1" class="level3">
<h3 class="anchored" data-anchor-id="gender-1">Gender</h3>
<div id="cell-59" class="cell" data-execution_count="87">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>pregGenderRisk <span class="op">=</span> []</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> code, gender <span class="kw">in</span> gen_code.items():</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    avRisk <span class="op">=</span> find_risk(code, <span class="st">'gender'</span>, pred_prob)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    newRow <span class="op">=</span> {<span class="st">'gender'</span>: gender, <span class="st">'risk'</span>: avRisk}</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    pregGenderRisk.append(newRow)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>pregGenderRisk <span class="op">=</span> pd.DataFrame(pregGenderRisk)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>pregGenderRisk <span class="op">=</span> pregGenderRisk.sort_values(by<span class="op">=</span><span class="st">'risk'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>pregGenderRisk</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="87">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">gender</th>
<th data-quarto-table-cell-role="th">risk</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>F</td>
<td>0.074523</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>M</td>
<td>0.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>This result may seem a bit redundant or silly, it makes sense as generally people identified as male do not get pregnant.</p>
</section>
<section id="ethnicity-1" class="level3">
<h3 class="anchored" data-anchor-id="ethnicity-1">Ethnicity</h3>
<div id="cell-62" class="cell" data-execution_count="88">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>av_risk_eth <span class="op">=</span> []</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> code, name <span class="kw">in</span> eth_code.items():</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    av <span class="op">=</span> find_risk(code, <span class="st">'ethnicity'</span>, pred_prob)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    new_row <span class="op">=</span> {<span class="st">'eth'</span>: name, <span class="st">'risk'</span>: av}</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    av_risk_eth.append(new_row)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>av_risk_eth_df <span class="op">=</span> pd.DataFrame(av_risk_eth)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>av_risk_eth_df <span class="op">=</span> av_risk_eth_df.sort_values(by<span class="op">=</span><span class="st">'risk'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-63" class="cell" data-execution_count="89">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>av_risk_eth_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="89">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">eth</th>
<th data-quarto-table-cell-role="th">risk</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>dominican</td>
<td>0.074523</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>scottish</td>
<td>0.074523</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>american</td>
<td>0.054199</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>central_american</td>
<td>0.053231</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">19</td>
<td>west_indian</td>
<td>0.049682</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>french_canadian</td>
<td>0.049682</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>mexican</td>
<td>0.049682</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">14</td>
<td>portuguese</td>
<td>0.047908</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>chinese</td>
<td>0.042585</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>french</td>
<td>0.039746</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">11</td>
<td>italian</td>
<td>0.038269</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>english</td>
<td>0.036060</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>african</td>
<td>0.034395</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>asian_indian</td>
<td>0.031939</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">15</td>
<td>puerto_rican</td>
<td>0.031529</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">18</td>
<td>swedish</td>
<td>0.029809</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>irish</td>
<td>0.025262</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>polish</td>
<td>0.024841</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>german</td>
<td>0.023289</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">16</td>
<td>russian</td>
<td>0.014905</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Here we see that our finding that Black patients are more likely to experience pregnancy-related complications is driven largely by Dominican patients.</p>
</section>
<section id="birthplace-1" class="level3">
<h3 class="anchored" data-anchor-id="birthplace-1">Birthplace</h3>
<div id="cell-66" class="cell" data-execution_count="90">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>birthplace_counts <span class="op">=</span> X_test.groupby(<span class="st">'birthplace'</span>).size().reset_index(name<span class="op">=</span><span class="st">'count'</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>town_info_rich, town_info_poor <span class="op">=</span> find_town_info_all(birthplace_counts, <span class="st">'birthplace'</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>richTownsUsed, richPeopleCount <span class="op">=</span> get_towns_by_sum_pop(town_info_rich, <span class="st">'birthplace'</span>)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>poorTownsUsed, poorPeopleCount <span class="op">=</span> get_towns_by_sum_pop(town_info_poor, <span class="st">'birthplace'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-67" class="cell" data-execution_count="91">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">234</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>av_rich_prob <span class="op">=</span> get_av_prob_bp(richTownsUsed, <span class="st">'birthplace'</span>, bp_code)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>av_poor_prob <span class="op">=</span> get_av_prob_bp(poorTownsUsed, <span class="st">'birthplace'</span>, bp_code)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"av_rich_prob: "</span>, av_rich_prob, <span class="st">"av_poor_prob: "</span>, av_poor_prob)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>av_rich_prob:  0.038981469137448335 av_poor_prob:  0.03668844154112784</code></pre>
</div>
</div>
</section>
<section id="current-town-of-residence-1" class="level3">
<h3 class="anchored" data-anchor-id="current-town-of-residence-1">Current Town of Residence</h3>
<div id="cell-69" class="cell" data-execution_count="92">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>curr_counts <span class="op">=</span> X_test.groupby(<span class="st">'curr_town'</span>).size().reset_index(name<span class="op">=</span><span class="st">'count'</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>town_info_rich, town_info_poor <span class="op">=</span> find_town_info_all(curr_counts, <span class="st">'curr_town'</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>richTownsUsed, richPeopleCount <span class="op">=</span> get_towns_by_sum_pop(town_info_rich, <span class="st">'curr_town'</span>)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>poorTownsUsed, poorPeopleCount <span class="op">=</span> get_towns_by_sum_pop(town_info_poor, <span class="st">'curr_town'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-70" class="cell" data-execution_count="93">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">234</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>av_rich_prob <span class="op">=</span> get_av_prob_bp(richTownsUsed, <span class="st">'curr_town'</span>, bp_code)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>av_poor_prob <span class="op">=</span> get_av_prob_bp(poorTownsUsed, <span class="st">'curr_town'</span>, bp_code)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"av_rich_prob: "</span>, av_rich_prob, <span class="st">"av_poor_prob: "</span>, av_poor_prob)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>av_rich_prob:  0.04586055192640981 av_poor_prob:  0.03630627027507444</code></pre>
</div>
</div>
<p>This finding was somewhat surprising to us, in that wealthier towns were found to have higher risks of pregnancy complications. We discuss the potential implications of this result in our results section.</p>
</section>
</section>
<section id="cancer-analysis" class="level1">
<h1>Cancer Analysis</h1>
<div id="cell-73" class="cell" data-execution_count="94">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">2</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>X_train, y_train, X_test, y_test, race_code, eth_code, gen_code, bp_code, curr_code <span class="op">=</span> prep_data(conditions_cancer)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co">#getting rid of few NaN values</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>X_train.fillna(<span class="fl">0.0</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="co">#train the model</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">500</span>)</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>train_model(X_train, y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>best LR : 0.9486775980338212
best DTC: 0.9546641722607386
best max depth:  {'max_depth': 1}
best RFC:  0.9546641722607386
best max depth:  {'max_depth': 1}
best SVM:  0.9546641722607386
best score overall is:  0.9546641722607386  with model:  DTC</code></pre>
</div>
</div>
<p>Once again we find that the model with the best score is DTC, The Decision Tree Classifier, with about 98% accuracy.</p>
<div id="cell-75" class="cell" data-execution_count="95">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>DTC <span class="op">=</span> DecisionTreeClassifier(max_depth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>DTC.fit(X_train, y_train)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>pred_prob <span class="op">=</span> DTC.predict_proba(X_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="race-2" class="level3">
<h3 class="anchored" data-anchor-id="race-2">Race</h3>
<div id="cell-77" class="cell" data-execution_count="96">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>cancerRaceRisk <span class="op">=</span> []</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> code, race <span class="kw">in</span> race_code.items():</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    avRisk <span class="op">=</span> find_risk(code, <span class="st">'race'</span>, pred_prob)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    newRow <span class="op">=</span> {<span class="st">'race'</span>: race, <span class="st">'risk'</span>: avRisk}</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    cancerRaceRisk.append(newRow)</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>cancerRaceRisk <span class="op">=</span> pd.DataFrame(cancerRaceRisk)</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>cancerRaceRisk <span class="op">=</span> cancerRaceRisk.sort_values(by<span class="op">=</span><span class="st">'risk'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>cancerRaceRisk</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="96">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">race</th>
<th data-quarto-table-cell-role="th">risk</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>white</td>
<td>0.051942</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>hispanic</td>
<td>0.051650</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>black</td>
<td>0.046859</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>asian</td>
<td>0.034009</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We find across the board cancer rates are somewhat even, but that at the extremes white patients have almost a 52% risk of being classified with cancer,and Asian patients have around a 34% risk.</p>
</section>
<section id="gender-2" class="level3">
<h3 class="anchored" data-anchor-id="gender-2">Gender</h3>
<div id="cell-80" class="cell" data-execution_count="97">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>cancerGenderRisk <span class="op">=</span> []</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> code, gender <span class="kw">in</span> gen_code.items():</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    avRisk <span class="op">=</span> find_risk(code, <span class="st">'gender'</span>, pred_prob)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    newRow <span class="op">=</span> {<span class="st">'gender'</span>: gender, <span class="st">'risk'</span>: avRisk}</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    cancerGenderRisk.append(newRow)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>cancerGenderRisk <span class="op">=</span> pd.DataFrame(cancerGenderRisk)</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>cancerGenderRisk <span class="op">=</span> cancerGenderRisk.sort_values(by<span class="op">=</span><span class="st">'risk'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>cancerGenderRisk</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="97">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">gender</th>
<th data-quarto-table-cell-role="th">risk</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>M</td>
<td>0.053825</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>F</td>
<td>0.047147</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Women are slightly less likely to have cancer.</p>
</section>
<section id="ethnicity-2" class="level3">
<h3 class="anchored" data-anchor-id="ethnicity-2">Ethnicity</h3>
<div id="cell-83" class="cell" data-execution_count="98">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>cancerEthRisk <span class="op">=</span> []</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> code, name <span class="kw">in</span> eth_code.items():</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    av <span class="op">=</span> find_risk(code, <span class="st">'ethnicity'</span>, pred_prob)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    new_row <span class="op">=</span> {<span class="st">'eth'</span>: name, <span class="st">'risk'</span>: av}</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    cancerEthRisk.append(new_row)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>cancerEthRisk <span class="op">=</span> pd.DataFrame(cancerEthRisk)</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>cancerEthRisk <span class="op">=</span> cancerEthRisk.sort_values(by<span class="op">=</span><span class="st">'risk'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>cancerEthRisk</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="98">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">eth</th>
<th data-quarto-table-cell-role="th">risk</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>german</td>
<td>0.105675</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>puerto_rican</td>
<td>0.067085</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>african</td>
<td>0.067085</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>chinese</td>
<td>0.062675</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">11</td>
<td>italian</td>
<td>0.059576</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>english</td>
<td>0.057127</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">13</td>
<td>polish</td>
<td>0.049934</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">10</td>
<td>irish</td>
<td>0.049557</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>portuguese</td>
<td>0.048342</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">18</td>
<td>swedish</td>
<td>0.045475</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>dominican</td>
<td>0.045475</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>american</td>
<td>0.041827</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>central_american</td>
<td>0.034009</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>french</td>
<td>0.032097</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>asian_indian</td>
<td>0.005342</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>french_canadian</td>
<td>0.005342</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>mexican</td>
<td>0.005342</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>west_indian</td>
<td>0.005342</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>russian</td>
<td>0.005342</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>scottish</td>
<td>0.005342</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Our results for ethnicity largely match the results we found distinguishing by race.</p>
</section>
<section id="birthplace-2" class="level3">
<h3 class="anchored" data-anchor-id="birthplace-2">Birthplace</h3>
<div id="cell-86" class="cell" data-execution_count="99">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>av_rich_prob <span class="op">=</span> get_av_prob_bp(richTownsUsed, <span class="st">'birthplace'</span>, bp_code)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>av_poor_prob <span class="op">=</span> get_av_prob_bp(poorTownsUsed, <span class="st">'birthplace'</span>, bp_code)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"av_rich_prob: "</span>, av_rich_prob, <span class="st">"av_poor_prob: "</span>, av_poor_prob)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>av_rich_prob:  0.06399830132085002 av_poor_prob:  0.04238804096017698</code></pre>
</div>
</div>
</section>
<section id="current-town-of-residence-2" class="level3">
<h3 class="anchored" data-anchor-id="current-town-of-residence-2">Current Town of Residence</h3>
<div id="cell-88" class="cell" data-execution_count="100">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>av_rich_prob <span class="op">=</span> get_av_prob_bp(richTownsUsed, <span class="st">'curr_town'</span>, bp_code)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>av_poor_prob <span class="op">=</span> get_av_prob_bp(poorTownsUsed, <span class="st">'curr_town'</span>, bp_code)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"av_rich_prob: "</span>, av_rich_prob, <span class="st">"av_poor_prob: "</span>, av_poor_prob)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>av_rich_prob:  0.03621368085712754 av_poor_prob:  0.05164958111475114</code></pre>
</div>
</div>
<p>We note that for birthplace, people in rich towns are more likely to get diagnosed with cancer as opposed to people from poorer towns. For current town of residence, the opposite is true.</p>
</section>
</section>
<section id="heart-analysis" class="level1">
<h1>Heart Analysis</h1>
<div id="cell-91" class="cell" data-execution_count="101">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">210</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>X_train, y_train, X_test, y_test, race_code, eth_code, gen_code, bp_code, curr_code <span class="op">=</span> prep_data(conditions_heart)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="co">#getting rid of few NaN values</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>X_train.fillna(<span class="fl">0.0</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="co">#train the model</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">20</span>)</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>train_model(X_train, y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/sophie/anaconda3/envs/ml-0451/lib/python3.9/site-packages/sklearn/linear_model/_logistic.py:458: ConvergenceWarning: lbfgs failed to converge (status=1):
STOP: TOTAL NO. of f AND g EVALUATIONS EXCEEDS LIMIT.

Increase the number of iterations (max_iter) or scale the data as shown in:
    https://scikit-learn.org/stable/modules/preprocessing.html
Please also refer to the documentation for alternative solver options:
    https://scikit-learn.org/stable/modules/linear_model.html#logistic-regression
  n_iter_i = _check_optimize_result(
/Users/sophie/anaconda3/envs/ml-0451/lib/python3.9/site-packages/sklearn/linear_model/_logistic.py:458: ConvergenceWarning: lbfgs failed to converge (status=1):
STOP: TOTAL NO. of f AND g EVALUATIONS EXCEEDS LIMIT.

Increase the number of iterations (max_iter) or scale the data as shown in:
    https://scikit-learn.org/stable/modules/preprocessing.html
Please also refer to the documentation for alternative solver options:
    https://scikit-learn.org/stable/modules/linear_model.html#logistic-regression
  n_iter_i = _check_optimize_result(</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>best LR : 0.87766773045743
best DTC: 0.8973478595796193
best max depth:  {'max_depth': 1}
best RFC:  0.8999156303877335
best max depth:  {'max_depth': None}
best SVM:  0.8973478595796193
best score overall is:  0.8999156303877335  with model:  RFC</code></pre>
</div>
</div>
<section id="compute-average-risk-scores-1" class="level3">
<h3 class="anchored" data-anchor-id="compute-average-risk-scores-1">Compute Average Risk scores</h3>
<p>We found that the best model to predict probabilities for all our entries in this case would be RFC.</p>
<div id="cell-93" class="cell" data-execution_count="115">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>RFC <span class="op">=</span> RandomForestClassifier(random_state<span class="op">=</span><span class="dv">0</span>, max_depth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>RFC.fit(X_train, y_train)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>pred_prob <span class="op">=</span> RFC.predict_proba(X_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="compare-across-race-gender-ethnicity-1" class="level3">
<h3 class="anchored" data-anchor-id="compare-across-race-gender-ethnicity-1">4. Compare Across Race, Gender, Ethnicity</h3>
</section>
<section id="race-3" class="level3">
<h3 class="anchored" data-anchor-id="race-3">Race</h3>
<div id="cell-96" class="cell" data-execution_count="116">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>heartRaceRisk <span class="op">=</span> []</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> code, race <span class="kw">in</span> race_code.items():</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    avRisk <span class="op">=</span> find_risk(code, <span class="st">'race'</span>, pred_prob)</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    newRow <span class="op">=</span> {<span class="st">'race'</span>: race, <span class="st">'risk'</span>: avRisk}</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>    heartRaceRisk.append(newRow)</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>heartRaceRisk <span class="op">=</span> pd.DataFrame(heartRaceRisk)</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>heartRaceRisk <span class="op">=</span> heartRaceRisk.sort_values(by<span class="op">=</span><span class="st">'risk'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>heartRaceRisk</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="116">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">race</th>
<th data-quarto-table-cell-role="th">risk</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>asian</td>
<td>0.510746</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>white</td>
<td>0.502101</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>black</td>
<td>0.491353</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>hispanic</td>
<td>0.491280</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We find that the demographic with the highest likelihood of having heart problems is Asian, but overall the results are fairly even.</p>
</section>
<section id="gender-3" class="level3">
<h3 class="anchored" data-anchor-id="gender-3">Gender</h3>
<div id="cell-99" class="cell" data-execution_count="117">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>heartGenderRisk <span class="op">=</span> []</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> code, gender <span class="kw">in</span> gen_code.items():</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    avRisk <span class="op">=</span> find_risk(code, <span class="st">'gender'</span>, pred_prob)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>    newRow <span class="op">=</span> {<span class="st">'gender'</span>: gender, <span class="st">'risk'</span>: avRisk}</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>    heartGenderRisk.append(newRow)</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>heartGenderRisk <span class="op">=</span> pd.DataFrame(heartGenderRisk)</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>heartGenderRisk <span class="op">=</span> heartGenderRisk.sort_values(by<span class="op">=</span><span class="st">'risk'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>heartGenderRisk</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="117">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">gender</th>
<th data-quarto-table-cell-role="th">risk</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>F</td>
<td>0.508013</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>M</td>
<td>0.492275</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>According to our results, women and men are equally likely to have heart conditions, which disagrees with real medical trends that show men are much more likely to have these conditions.</p>
</section>
<section id="ethnicity-3" class="level3">
<h3 class="anchored" data-anchor-id="ethnicity-3">Ethnicity</h3>
<div id="cell-102" class="cell" data-execution_count="118">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>heartEthRisk <span class="op">=</span> []</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> code, name <span class="kw">in</span> eth_code.items():</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    av <span class="op">=</span> find_risk(code, <span class="st">'ethnicity'</span>, pred_prob)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>    new_row <span class="op">=</span> {<span class="st">'eth'</span>: name, <span class="st">'risk'</span>: av}</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>    heartEthRisk.append(new_row)</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>heartEthRisk <span class="op">=</span> pd.DataFrame(heartEthRisk)</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>heartEthRisk <span class="op">=</span> heartEthRisk.sort_values(by<span class="op">=</span><span class="st">'risk'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>heartEthRisk</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="118">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">eth</th>
<th data-quarto-table-cell-role="th">risk</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>asian_indian</td>
<td>0.556735</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>scottish</td>
<td>0.556144</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">13</td>
<td>polish</td>
<td>0.553649</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">12</td>
<td>mexican</td>
<td>0.534791</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>portuguese</td>
<td>0.519123</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>american</td>
<td>0.516831</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>german</td>
<td>0.516270</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">16</td>
<td>russian</td>
<td>0.511412</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>swedish</td>
<td>0.508385</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>english</td>
<td>0.500485</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>african</td>
<td>0.500460</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>french</td>
<td>0.498784</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>french_canadian</td>
<td>0.494611</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>italian</td>
<td>0.490876</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">19</td>
<td>west_indian</td>
<td>0.489579</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">10</td>
<td>irish</td>
<td>0.489033</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>central_american</td>
<td>0.487097</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>puerto_rican</td>
<td>0.482365</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>dominican</td>
<td>0.480579</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>chinese</td>
<td>0.464757</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Again, here we see very little variation.</p>
</section>
<section id="birthplace-3" class="level3">
<h3 class="anchored" data-anchor-id="birthplace-3">Birthplace</h3>
<div id="cell-105" class="cell" data-execution_count="106">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>av_rich_prob <span class="op">=</span> get_av_prob_bp(richTownsUsed, <span class="st">'birthplace'</span>, bp_code)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>av_poor_prob <span class="op">=</span> get_av_prob_bp(poorTownsUsed, <span class="st">'birthplace'</span>, bp_code)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"av_rich_prob: "</span>, av_rich_prob, <span class="st">"av_poor_prob: "</span>, av_poor_prob)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>av_rich_prob:  0.10892307692307693 av_poor_prob:  0.1103076923076923</code></pre>
</div>
</div>
</section>
<section id="current-town-of-residence-3" class="level3">
<h3 class="anchored" data-anchor-id="current-town-of-residence-3">Current Town of Residence</h3>
<div id="cell-107" class="cell" data-execution_count="107">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>av_rich_prob <span class="op">=</span> get_av_prob_bp(richTownsUsed, <span class="st">'curr_town'</span>, bp_code)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>av_poor_prob <span class="op">=</span> get_av_prob_bp(poorTownsUsed, <span class="st">'curr_town'</span>, bp_code)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"av_rich_prob: "</span>, av_rich_prob, <span class="st">"av_poor_prob: "</span>, av_poor_prob)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>av_rich_prob:  0.08661538461538462 av_poor_prob:  0.09256410256410255</code></pre>
</div>
</div>
<p>It seems as if there are not significant differences between the risk of heart diseases between wealthier and less-wealthy birthplace towns or current towns of residence.</p>
</section>
</section>
<section id="lungs-analysis" class="level1">
<h1>Lungs Analysis</h1>
<div id="cell-110" class="cell" data-execution_count="108">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">400</span>)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>X_train, y_train, X_test, y_test, race_code, eth_code, gen_code, bp_code, curr_code <span class="op">=</span> prep_data(conditions_lungs)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="co">#getting rid of few NaN values</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>X_train.fillna(<span class="fl">0.0</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="co">#train the model</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>train_model(X_train, y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>best LR : 0.5705770147830234
best DTC: 0.6107626279300099
best max depth:  {'max_depth': 5}
best RFC:  0.6210850665786289
best max depth:  {'max_depth': 4}
best SVM:  0.5971387696709585
best score overall is:  0.6210850665786289  with model:  RFC</code></pre>
</div>
</div>
<section id="compute-average-risk-scores-2" class="level3">
<h3 class="anchored" data-anchor-id="compute-average-risk-scores-2">Compute Average Risk scores</h3>
<p>We found that the best model to predict probabilities for all our entries iin this case would be RFC.</p>
<div id="cell-112" class="cell" data-execution_count="124">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>RFC <span class="op">=</span> RandomForestClassifier(random_state<span class="op">=</span><span class="dv">0</span>, max_depth<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>RFC.fit(X_train, y_train)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>pred_prob <span class="op">=</span> RFC.predict_proba(X_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="compare-across-race-gender-ethnicity-2" class="level3">
<h3 class="anchored" data-anchor-id="compare-across-race-gender-ethnicity-2">4. Compare Across Race, Gender, Ethnicity</h3>
</section>
<section id="race-4" class="level3">
<h3 class="anchored" data-anchor-id="race-4">Race</h3>
<div id="cell-115" class="cell" data-execution_count="125">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>lungsRaceRisk <span class="op">=</span> []</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> code, race <span class="kw">in</span> race_code.items():</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>    avRisk <span class="op">=</span> find_risk(code, <span class="st">'race'</span>, pred_prob)</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>    newRow <span class="op">=</span> {<span class="st">'race'</span>: race, <span class="st">'risk'</span>: avRisk}</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>    lungsRaceRisk.append(newRow)</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>lungsRaceRisk <span class="op">=</span> pd.DataFrame(lungsRaceRisk)</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>lungsRaceRisk <span class="op">=</span> lungsRaceRisk.sort_values(by<span class="op">=</span><span class="st">'risk'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>lungsRaceRisk</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="125">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">race</th>
<th data-quarto-table-cell-role="th">risk</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>asian</td>
<td>0.514338</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>black</td>
<td>0.509092</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>white</td>
<td>0.507817</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>hispanic</td>
<td>0.492106</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We find very little variation for risk rates for lung issues for race.</p>
</section>
<section id="gender-4" class="level3">
<h3 class="anchored" data-anchor-id="gender-4">Gender</h3>
<div id="cell-118" class="cell" data-execution_count="122">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>lungsGenderRisk <span class="op">=</span> []</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> code, gender <span class="kw">in</span> gen_code.items():</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>    avRisk <span class="op">=</span> find_risk(code, <span class="st">'gender'</span>, pred_prob)</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>    newRow <span class="op">=</span> {<span class="st">'gender'</span>: gender, <span class="st">'risk'</span>: avRisk}</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>    lungsGenderRisk.append(newRow)</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>lungsGenderRisk <span class="op">=</span> pd.DataFrame(lungsGenderRisk)</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>lungsGenderRisk <span class="op">=</span> lungsGenderRisk.sort_values(by<span class="op">=</span><span class="st">'risk'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>lungsGenderRisk</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="122">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">gender</th>
<th data-quarto-table-cell-role="th">risk</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>F</td>
<td>0.519215</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>M</td>
<td>0.493550</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Again, there are pretty even rates for gender and risk of having lung complications.</p>
</section>
<section id="ethnicity-4" class="level3">
<h3 class="anchored" data-anchor-id="ethnicity-4">Ethnicity</h3>
<div id="cell-121" class="cell" data-execution_count="126">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>lungsEthRisk <span class="op">=</span> []</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> code, name <span class="kw">in</span> eth_code.items():</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>    av <span class="op">=</span> find_risk(code, <span class="st">'ethnicity'</span>, pred_prob)</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>    new_row <span class="op">=</span> {<span class="st">'eth'</span>: name, <span class="st">'risk'</span>: av}</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>    lungsEthRisk.append(new_row)</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>lungsEthRisk <span class="op">=</span> pd.DataFrame(lungsEthRisk)</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>lungsEthRisk <span class="op">=</span> lungsEthRisk.sort_values(by<span class="op">=</span><span class="st">'risk'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>lungsEthRisk</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="126">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">eth</th>
<th data-quarto-table-cell-role="th">risk</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">13</td>
<td>polish</td>
<td>0.583031</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">12</td>
<td>mexican</td>
<td>0.580761</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">17</td>
<td>scottish</td>
<td>0.577455</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>asian_indian</td>
<td>0.577379</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>swedish</td>
<td>0.560368</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>african</td>
<td>0.559980</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>russian</td>
<td>0.549236</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>american</td>
<td>0.548145</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>german</td>
<td>0.521056</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">14</td>
<td>portuguese</td>
<td>0.516368</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>english</td>
<td>0.514735</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>italian</td>
<td>0.498196</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>french_canadian</td>
<td>0.487928</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>french</td>
<td>0.485426</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>irish</td>
<td>0.481814</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>puerto_rican</td>
<td>0.479351</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>dominican</td>
<td>0.473627</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>central_american</td>
<td>0.463493</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">19</td>
<td>west_indian</td>
<td>0.457941</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>chinese</td>
<td>0.451298</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>This analysis follows the trend of generally even probabilities throughout, in the most extreme cases with polish people having 58% risk and chinese people having 45%.</p>
</section>
<section id="birthplace-4" class="level3">
<h3 class="anchored" data-anchor-id="birthplace-4">Birthplace</h3>
<div id="cell-124" class="cell" data-execution_count="127">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>av_rich_prob <span class="op">=</span> get_av_prob_bp(richTownsUsed, <span class="st">'birthplace'</span>, bp_code)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>av_poor_prob <span class="op">=</span> get_av_prob_bp(poorTownsUsed, <span class="st">'birthplace'</span>, bp_code)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"av_rich_prob: "</span>, av_rich_prob, <span class="st">"av_poor_prob: "</span>, av_poor_prob)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>av_rich_prob:  0.4872429058942045 av_poor_prob:  0.5189382015534418</code></pre>
</div>
</div>
</section>
<section id="current-town-of-residence-4" class="level3">
<h3 class="anchored" data-anchor-id="current-town-of-residence-4">Current Town of Residence</h3>
<div id="cell-126" class="cell" data-execution_count="128">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>av_rich_prob <span class="op">=</span> get_av_prob_bp(richTownsUsed, <span class="st">'curr_town'</span>, bp_code)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>av_poor_prob <span class="op">=</span> get_av_prob_bp(poorTownsUsed, <span class="st">'curr_town'</span>, bp_code)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"av_rich_prob: "</span>, av_rich_prob, <span class="st">"av_poor_prob: "</span>, av_poor_prob)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>av_rich_prob:  0.5039833131472166 av_poor_prob:  0.5124758651408807</code></pre>
</div>
</div>
<p>The results for the risk score for patients of different race, gender, ethnicity, birthplace town, and current town of residence are curious as every risk score hovers around a 0.5 and generally even throughout the different demographics. This points to the conclusion that we are maybe investigating too large amount of conditions under lung ailments.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>